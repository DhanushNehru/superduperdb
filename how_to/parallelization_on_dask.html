<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Example notebooks" href="../examples/index.html" /><link rel="prev" title="Perform change data capture (CDC)" href="mongo_cdc.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.05.20 -->
        <title>Run computations on Dask - SuperDuperDB documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SuperDuperDB  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SuperDuperDB  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/index.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/minimum_working_example.html">Minimum working example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/features.html">Supported Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/faq.html">Frequently asked questions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../usage/index.html">SuperDuperDB Usage</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of SuperDuperDB Usage</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/datalayer.html">Datalayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/queries.html">Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/encoders.html">Encoders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/datasets.html">Datasets</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">How to …</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of How to …</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="playground.html">Download, install and setup SuperDuperDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongo_cdc.html">Perform change data capture (CDC)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Run computations on Dask</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/index.html">Example notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Example notebooks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/mnist_torch.html">Training and maintaining MNIST predictions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/mnist_sklearn.html">MNIST using scikit-learn and SuperDuperDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/openai.html">OpenAI vector search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/compare_vector_search_solutions.html">Compare vector search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/sentiment_analysis_use_case.html">Sentiment analysis with transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/voice_memos.html">Cataloguing voice-memos for a self managed personal assistant</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../background/index.html">Background of SuperDuperDB</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Background of SuperDuperDB</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../background/common_issues.html">Common issues in AI-data development</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../source/modules.html">superduperdb</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of superduperdb</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../source/superduperdb.html">superduperdb package</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of superduperdb package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../source/superduperdb.cli.html">superduperdb.cli package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../source/superduperdb.cluster.html">superduperdb.cluster package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../source/superduperdb.core.html">superduperdb.core package</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../source/superduperdb.datalayer.html">superduperdb.datalayer package</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of superduperdb.datalayer package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.datalayer.base.html">superduperdb.datalayer.base package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.datalayer.mongodb.html">superduperdb.datalayer.mongodb package</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../source/superduperdb.encoders.html">superduperdb.encoders package</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of superduperdb.encoders package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.encoders.numpy.html">superduperdb.encoders.numpy package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.encoders.pillow.html">superduperdb.encoders.pillow package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.encoders.torch.html">superduperdb.encoders.torch package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.encoders.vectors.html">superduperdb.encoders.vectors package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../source/superduperdb.metrics.html">superduperdb.metrics package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../source/superduperdb.misc.html">superduperdb.misc package</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../source/superduperdb.models.html">superduperdb.models package</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of superduperdb.models package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.models.openai.html">superduperdb.models.openai package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.models.sklearn.html">superduperdb.models.sklearn package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.models.torch.html">superduperdb.models.torch package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../source/superduperdb.models.transformers.html">superduperdb.models.transformers package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../source/superduperdb.vector_search.html">superduperdb.vector_search package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="Run-computations-on-Dask">
<h1>Run computations on Dask<a class="headerlink" href="#Run-computations-on-Dask" title="Permalink to this heading">#</a></h1>
<p>In this example, we show how to run computations on a Dask cluster, rather than in the same process as data is submitted from. This allows compute to be scaled horizontally, and also submitted to workers, which may utilize specialized hardware, including GPUs.</p>
<p>To do this, we need to override the default configuration. To do this, we only need specify the configurations which diverge from the defaults. In particular, to use a Dask cluster, we specify <code class="docutils literal notranslate"><span class="pre">CFG.distributed</span> <span class="pre">=</span> <span class="pre">True</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;distributed&quot;: true}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>configs.json
<span class="o">!</span>cat<span class="w"> </span>configs.json
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;distributed&#34;: true}
</pre></div></div>
</div>
<p>We can now confirm, by importing the loaded configuration <code class="docutils literal notranslate"><span class="pre">CFG</span></code>, that <code class="docutils literal notranslate"><span class="pre">CFG.distribute</span> <span class="pre">==</span> <span class="pre">True</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">superduperdb</span> <span class="kn">import</span> <span class="n">CFG</span>

<span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">CFG</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;apis&#39;: {&#39;providers&#39;: {},
          &#39;retry&#39;: {&#39;stop_after_attempt&#39;: 2,
                    &#39;wait_max&#39;: 10.0,
                    &#39;wait_min&#39;: 4.0,
                    &#39;wait_multiplier&#39;: 1.0}},
 &#39;cdc&#39;: False,
 &#39;dask&#39;: {&#39;deserializers&#39;: [],
          &#39;ip&#39;: &#39;localhost&#39;,
          &#39;local&#39;: True,
          &#39;password&#39;: &#39;&#39;,
          &#39;port&#39;: 8786,
          &#39;serializers&#39;: [],
          &#39;username&#39;: &#39;&#39;},
 &#39;data_layers&#39;: {&#39;artifact&#39;: {&#39;cls&#39;: &#39;mongodb&#39;,
                              &#39;connection&#39;: &#39;pymongo&#39;,
                              &#39;kwargs&#39;: {&#39;host&#39;: &#39;localhost&#39;,
                                         &#39;password&#39;: &#39;testmongodbpassword&#39;,
                                         &#39;port&#39;: 27018,
                                         &#39;username&#39;: &#39;testmongodbuser&#39;},
                              &#39;name&#39;: &#39;_filesystem:test_db&#39;},
                 &#39;data_backend&#39;: {&#39;cls&#39;: &#39;mongodb&#39;,
                                  &#39;connection&#39;: &#39;pymongo&#39;,
                                  &#39;kwargs&#39;: {&#39;host&#39;: &#39;localhost&#39;,
                                             &#39;password&#39;: &#39;testmongodbpassword&#39;,
                                             &#39;port&#39;: 27018,
                                             &#39;username&#39;: &#39;testmongodbuser&#39;},
                                  &#39;name&#39;: &#39;test_db&#39;},
                 &#39;metadata&#39;: {&#39;cls&#39;: &#39;mongodb&#39;,
                              &#39;connection&#39;: &#39;pymongo&#39;,
                              &#39;kwargs&#39;: {&#39;host&#39;: &#39;localhost&#39;,
                                         &#39;password&#39;: &#39;testmongodbpassword&#39;,
                                         &#39;port&#39;: 27018,
                                         &#39;username&#39;: &#39;testmongodbuser&#39;},
                              &#39;name&#39;: &#39;test_db&#39;}},
 &#39;distributed&#39;: True,
 &#39;logging&#39;: {&#39;kwargs&#39;: {},
             &#39;level&#39;: &lt;LogLevel.INFO: &#39;INFO&#39;&gt;,
             &#39;type&#39;: &lt;LogType.STDERR: &#39;STDERR&#39;&gt;},
 &#39;model_server&#39;: {&#39;host&#39;: &#39;127.0.0.1&#39;,
                  &#39;password&#39;: &#39;&#39;,
                  &#39;port&#39;: 5001,
                  &#39;username&#39;: &#39;&#39;},
 &#39;notebook&#39;: {&#39;ip&#39;: &#39;0.0.0.0&#39;, &#39;password&#39;: &#39;&#39;, &#39;port&#39;: 8888, &#39;token&#39;: &#39;&#39;},
 &#39;ray&#39;: {&#39;deployments&#39;: [],
         &#39;host&#39;: &#39;127.0.0.1&#39;,
         &#39;password&#39;: &#39;&#39;,
         &#39;port&#39;: 0,
         &#39;username&#39;: &#39;&#39;},
 &#39;server&#39;: {&#39;host&#39;: &#39;127.0.0.1&#39;, &#39;port&#39;: 3223, &#39;protocol&#39;: &#39;http&#39;},
 &#39;vector_search&#39;: {&#39;host&#39;: &#39;localhost&#39;,
                   &#39;password&#39;: &#39;&#39;,
                   &#39;port&#39;: 19530,
                   &#39;type&#39;: {&#39;backfill_batch_size&#39;: 100, &#39;inmemory&#39;: True},
                   &#39;username&#39;: &#39;&#39;}}
</pre></div></div>
</div>
<p>Now that we’ve set up the environment to use a Dask cluster, we can add some data to the <code class="docutils literal notranslate"><span class="pre">Datalayer</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">superduperdb.datalayer.base.build</span> <span class="kn">import</span> <span class="n">build_datalayer</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">build_datalayer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/dodo/SuperDuperDB/superduperdb/.venv/lib/python3.11/site-packages/distributed/node.py:182: UserWarning: Port 8787 is already in use.
Perhaps you already have a cluster running?
Hosting the HTTP server on port 49921 instead
  warnings.warn(
INFO:distributed.scheduler:State start
INFO:distributed.scheduler:  Scheduler at:     tcp://127.0.0.1:49922
INFO:distributed.scheduler:  dashboard at:  http://127.0.0.1:49921/status
INFO:distributed.nanny:        Start Nanny at: &#39;tcp://127.0.0.1:49925&#39;
INFO:distributed.nanny:        Start Nanny at: &#39;tcp://127.0.0.1:49926&#39;
INFO:distributed.nanny:        Start Nanny at: &#39;tcp://127.0.0.1:49927&#39;
INFO:distributed.nanny:        Start Nanny at: &#39;tcp://127.0.0.1:49928&#39;
INFO:distributed.scheduler:Register worker &lt;WorkerState &#39;tcp://127.0.0.1:49935&#39;, name: 2, status: init, memory: 0, processing: 0&gt;
INFO:distributed.scheduler:Starting worker compute stream, tcp://127.0.0.1:49935
INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49939
INFO:distributed.scheduler:Register worker &lt;WorkerState &#39;tcp://127.0.0.1:49933&#39;, name: 1, status: init, memory: 0, processing: 0&gt;
INFO:distributed.scheduler:Starting worker compute stream, tcp://127.0.0.1:49933
INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49940
INFO:distributed.scheduler:Register worker &lt;WorkerState &#39;tcp://127.0.0.1:49934&#39;, name: 0, status: init, memory: 0, processing: 0&gt;
INFO:distributed.scheduler:Starting worker compute stream, tcp://127.0.0.1:49934
INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49941
INFO:distributed.scheduler:Register worker &lt;WorkerState &#39;tcp://127.0.0.1:49942&#39;, name: 3, status: init, memory: 0, processing: 0&gt;
INFO:distributed.scheduler:Starting worker compute stream, tcp://127.0.0.1:49942
INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49944
INFO:distributed.scheduler:Receive client connection: Client-49aacf9a-2c26-11ee-890c-1e00f226d550
INFO:distributed.core:Starting established connection to tcp://127.0.0.1:49945
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">drop_database</span><span class="p">(</span><span class="s1">&#39;testdb&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">drop_database</span><span class="p">(</span><span class="s1">&#39;_filesystem:testdb&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As in the previous tutorials, we can wrap models from a range of AI frameworks to interoperate with the data set, as well as inserting data with, for instances, tensors of a specific data type:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymongo</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">superduperdb</span> <span class="kn">import</span> <span class="n">superduper</span>
<span class="kn">from</span> <span class="nn">superduperdb.core.document</span> <span class="kn">import</span> <span class="n">Document</span> <span class="k">as</span> <span class="n">D</span>
<span class="kn">from</span> <span class="nn">superduperdb.encoders.torch.tensor</span> <span class="kn">import</span> <span class="n">tensor</span>
<span class="kn">from</span> <span class="nn">superduperdb.datalayer.mongodb.query</span> <span class="kn">import</span> <span class="n">Collection</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">superduper</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="n">encoder</span><span class="o">=</span><span class="n">tensor</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,))</span>
<span class="p">)</span>

<span class="n">t32</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">128</span><span class="p">,))</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">Collection</span><span class="p">(</span><span class="s1">&#39;localcluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span>
        <span class="p">[</span><span class="n">D</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">t32</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">128</span><span class="p">))})</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)],</span>
        <span class="n">encoders</span><span class="o">=</span><span class="p">(</span><span class="n">t32</span><span class="p">,)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:root:Could not get an identifier from submitted function, creating one!
INFO:root:found 0 uris
</pre></div></div>
</div>
<p>Now when we instruct the model to make predictions based on the <code class="docutils literal notranslate"><span class="pre">Datalayer</span></code>, the computations run on the Dask cluster. The <code class="docutils literal notranslate"><span class="pre">.predict</span></code> method returns a <code class="docutils literal notranslate"><span class="pre">Job</span></code> instance, which can be used to monitor the progress of the computation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
    <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span>
    <span class="n">select</span><span class="o">=</span><span class="n">Collection</span><span class="p">(</span><span class="s1">&#39;localcluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">job</span><span class="o">.</span><span class="n">watch</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>To check that the <code class="docutils literal notranslate"><span class="pre">Datalayer</span></code> has been populated with outputs, we can check the <code class="docutils literal notranslate"><span class="pre">&quot;_outputs&quot;</span></code> field of a record:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Collection</span><span class="p">(</span><span class="s1">&#39;localcluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find_one</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Document({&#39;_id&#39;: ObjectId(&#39;64c1d71719f67e1b48cdf3dd&#39;), &#39;x&#39;: Encodable(x=tensor([-0.1185, -0.0404, -0.1605, -0.1824, -0.3947,  1.8372, -0.0539, -0.4879,
         0.8195,  1.5238, -1.4167, -2.0685, -0.9496, -0.1749,  1.2830,  0.8140,
         0.9339, -0.4342, -1.1220, -0.3847, -1.9544,  0.1534, -1.2628, -0.3808,
        -0.8816, -1.6340, -0.2665,  0.1103, -0.5372, -2.4823, -0.7087,  1.3672,
         1.2557, -0.5210,  0.9967, -1.0727,  1.2504,  0.5167,  2.3840, -1.0954,
         1.4559, -0.3013,  0.6051,  0.6426,  0.0433, -1.4484,  0.4398, -0.9044,
         1.2979, -1.0627,  0.0968, -0.7796,  1.4209, -0.1462, -1.5939, -1.6432,
        -0.7866,  1.5465,  0.1046,  1.0507, -0.3342,  0.7803, -0.2175, -1.3123,
        -0.7993, -0.3464, -1.0265, -2.1460,  0.1070, -0.9112,  0.3214, -0.0166,
         0.9422, -0.6901,  0.5440,  0.0243,  0.8935, -1.1099, -0.9086, -0.1164,
        -0.8712, -0.3519,  0.2826, -1.7652,  0.6794, -0.1562, -0.1362,  0.9918,
         0.0920,  0.9796,  0.0780, -0.2145, -1.3863, -1.1139, -0.6165, -0.5944,
         0.0714, -0.8560, -0.4366, -0.6890, -0.0823,  1.5119, -1.6940, -1.1011,
        -1.2935, -0.0069,  0.4241,  0.0410, -0.0433,  0.0461, -0.8076,  1.2476,
        -0.7005, -1.0018, -0.1181,  1.5169, -0.2415,  0.2934, -0.8017, -0.0182,
        -0.9250, -0.4665,  1.4740,  0.1819,  2.7405,  0.6077, -0.7615, -0.9959]), encoder=Encoder(identifier=&#39;torch.float32[128]&#39;, decoder=&lt;Artifact artifact=&lt;superduperdb.encoders.torch.tensor.DecodeTensor object at 0x17cbd0350&gt; serializer=dill&gt;, encoder=&lt;Artifact artifact=&lt;superduperdb.encoders.torch.tensor.EncodeTensor object at 0x17cbd0410&gt; serializer=dill&gt;, shape=[128], version=1)), &#39;_fold&#39;: &#39;train&#39;, &#39;_outputs&#39;: {&#39;x&#39;: {&#39;linear&#39;: Encodable(x=tensor([ 0.5870, -0.2290, -0.3595, -0.0456,  0.7253,  0.7665,  0.7731]), encoder=Encoder(identifier=&#39;torch.float32[7]&#39;, decoder=&lt;Artifact artifact=&lt;superduperdb.encoders.torch.tensor.DecodeTensor object at 0x17cb90b50&gt; serializer=dill&gt;, encoder=&lt;Artifact artifact=&lt;superduperdb.encoders.torch.tensor.EncodeTensor object at 0x17cb64050&gt; serializer=dill&gt;, shape=[7], version=1))}}})
</pre></div></div>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../examples/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Example notebooks</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="mongo_cdc.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Perform change data capture (CDC)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; SuperDuperDB Inc., opensource@superduperdb.com
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>